annotation_ods = config['annotation_ods']
outdir = config['outdir']
raw_coloc_tsv = config['raw_coloc_tsv']

rule all:
    input:
        gwas=os.path.join(outdir, "cmpt_count_per_rsid/count_per_rsid_gwas.tsv"),
        tsv=os.path.join(outdir, "cmpt_pleiotropic_regions.py/region_window_100000.tsv"),
        png=os.path.join(outdir, "cmpt_pleiotropic_regions.py/regions_100000_length_hist.png"),

rule cmpt_pleiotropic_regions:
    input:
        gwas=os.path.join(outdir, "cmpt_count_per_rsid/count_per_rsid_gwas.tsv"),
    output:
        tsv=os.path.join(outdir, "cmpt_pleiotropic_regions.py/region_window_100000.tsv"),
        png=os.path.join(outdir, "cmpt_pleiotropic_regions.py/regions_100000_length_hist.png"),
    shell:
        "python scripts/cmpt_pleiotropic_regions.py {input.gwas} {output.tsv} {output.png}"

rule count_per_rsid:
    input:
        tsv=os.path.join(outdir, "annotate_h4.py/h4_annotated.tsv"),
    output:
        gwas=os.path.join(outdir, "cmpt_count_per_rsid/count_per_rsid_gwas.tsv"),
    params:
        rule_outdir=os.path.join(outdir, "cmpt_count_per_rsid")
    shell:
        "python scripts/cmpt_count_per_rsid.py {input.tsv} {params.rule_outdir}"

rule h4_annotated:
    input:
        coloc="out/manual_annotation/filter_h4.py/coloc_h4.tsv",
        annot=annotation_ods,
    output:
        tsv=os.path.join(outdir, "annotate_h4.py/h4_annotated.tsv"),
        ods=os.path.join(outdir, "annotate_h4.py/h4_annotated.ods"),
        bed=os.path.join(outdir, "annotate_h4.py/h4_annotated.bed"),
    shell:
        "python scripts/annotate_h4.py {input.coloc} {input.annot} {output.tsv} {output.ods} {output.bed}"

rule filter_h4:
    input:
        tsv=raw_coloc_tsv
    output:
        tsv=os.path.join(outdir, "filter_h4.py/coloc_h4.tsv")
    shell:
        "python scripts/filter_h4.py {input.tsv} {output.tsv}"
