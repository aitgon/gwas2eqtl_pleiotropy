"""
snakemake -j all -s tools/snkfl_vep.yml --config max_gwas_class_count=4 db_url='postgresql://chiliconcarne101usr:chiliconcarne101pwd@0.0.0.0:5435/gwas2eqtl' outdir=out/gwas418/pval_5e-08/r2_0.1/kb_1000/window_1000000/7_7 public_data_dir=/home/gonzalez/Software/public
"""

outdir = config['outdir']
max_gwas_class_count = config['max_gwas_class_count']
db_url = config['db_url']

rule all_03snkfl_analysis_vep:
    input:
        os.path.join(outdir, "pltbar_vep_consequence.py/vep.png"),

rule plt_vep_consequence:
    input:
        os.path.join(outdir, "cmpt_vep_consequence_fisher.py/cons_stat.tsv"),
    output:
        os.path.join(outdir, "pltbar_vep_consequence.py/vep.png"),
    params:
        max_gwas_class_count=(max_gwas_class_count-2)
    shell:
        "python scripts/pltbar_vep_consequence.py {input[0]} {params[0]} {output[0]}"

rule cmpt_vep_consequence_fisher:
    input:
        os.path.join(outdir, "cmpt_vep.py/vep_input.tsv"),
        os.path.join(outdir, "cmpt_vep.py/vep_output.tsv"),
    output:
        os.path.join(outdir, "cmpt_vep_consequence_fisher.py/cons_stat.tsv"),
    params:
        max_gwas_class_count=(max_gwas_class_count-2)
    threads: 25  # ~nb of vep consequences
    shell:
        "python scripts/cmpt_vep_consequence_fisher.py {params.max_gwas_class_count} {threads} {input[0]} {input[1]} {output[0]}"

rule cmpt_vep:
    input:
        os.path.join(outdir, "cmpt_count_per_rsid.py/count_per_rsid_gwas.tsv"),
    output:
        os.path.join(outdir, "cmpt_vep.py/vep_input.tsv"),
        os.path.join(outdir, "cmpt_vep.py/vep_output.tsv"),
    params:
        max_gwas_class_count=(max_gwas_class_count-2),
        db_url=db_url,
    shell:
        "python scripts/cmpt_vep.py {params.max_gwas_class_count} {params.db_url} {input[0]} {output[0]} {output[1]}"
