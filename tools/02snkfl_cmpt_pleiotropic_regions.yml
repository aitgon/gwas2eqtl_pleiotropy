"""
snakemake -j all -s tools/02snkfl_cmpt_pleiotropic_regions.yml --config etissue_class_ods=config/etissue_class.ods max_gwas_class_count=4 db_url='postgresql://chiliconcarne101usr:chiliconcarne101pwd@0.0.0.0:5435/gwas2eqtl' outdir=out/gwas418/pval_5e-08/r2_0.1/kb_1000/window_1000000/75_50
"""

etissue_class_ods = config['etissue_class_ods']
outdir = config['outdir']
max_gwas_class_count = config['max_gwas_class_count']
db_url = config['db_url']
snp_pp_h4 = config['snp_pp_h4']

wlength_lst = [1000, 3000, 10000, 30000, 100000]

rule all_02snkfl_cmpt_pleiotropic_regions:
    input:
        expand(os.path.join(outdir, "cmpt_pleiotropic_regions.py/{wlength}/region_window_{wlength}.tsv"), wlength=wlength_lst)

rule cmpt_pleiotropic_regions_wlength:
    input:
        gwas=os.path.join(outdir, "cmpt_count_per_rsid.py/count_per_rsid_gwas.tsv"),
    output:
        os.path.join(outdir, "cmpt_pleiotropic_regions.py/{wlength}/region_window_{wlength}.tsv"),
        os.path.join(outdir, "cmpt_pleiotropic_regions.py/{wlength}/region_hist_{wlength}.png"),
    params: wlength="{wlength}"
    shell:
        "python scripts/cmpt_pleiotropic_regions.py {params.wlength} {input.gwas} {output[0]} {output[1]}"

rule count_per_rsid:
    output:
        os.path.join(outdir, "cmpt_count_per_rsid.py/count_per_rsid_gwas.tsv"),
        os.path.join(outdir, "cmpt_count_per_rsid.py/count_per_rsid_egene.tsv"),
        os.path.join(outdir, "cmpt_count_per_rsid.py/count_per_rsid_etissue.tsv"),
        os.path.join(outdir, "cmpt_count_per_rsid.py/variant_pleio_1_flank_10_hg38.bed"),
        os.path.join(outdir, "cmpt_count_per_rsid.py/count_per_rsid_gwas_egene_etissue.tsv"),
        os.path.join(outdir, "cmpt_count_per_rsid.py/count_per_rsid_gwas_egene_etissue_corr.png"),
    params:
        snp_pp_h4=snp_pp_h4,
        max_gwas_class_count=max_gwas_class_count,
        db_url=db_url,
    shell:
        "python scripts/cmpt_count_per_rsid.py {params.snp_pp_h4} {params.max_gwas_class_count} {params.db_url} {output[0]} {output[5]}"
